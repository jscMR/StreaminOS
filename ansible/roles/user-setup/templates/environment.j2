# StreaminOS Environment Configuration
# Auto-generated by Ansible - DO NOT EDIT MANUALLY

# XDG Base Directory Specification
export XDG_CONFIG_HOME="{{ streaminos_xdg_config_home }}"
export XDG_DATA_HOME="{{ streaminos_xdg_data_home }}"
export XDG_CACHE_HOME="{{ streaminos_xdg_cache_home }}"
export XDG_STATE_HOME="{{ streaminos_xdg_state_home }}"
export XDG_RUNTIME_DIR="/run/user/{{ streaminos_uid }}"

# Wayland configuration
export WAYLAND_DISPLAY=wayland-1
export MOZ_ENABLE_WAYLAND=1
export QT_QPA_PLATFORM=wayland
export GDK_BACKEND=wayland
export SDL_VIDEODRIVER=wayland
export CLUTTER_BACKEND=wayland

# NVIDIA workarounds (if needed)
# export GBM_BACKEND=nvidia-drm
# export __GLX_VENDOR_LIBRARY_NAME=nvidia

# AMD GPU (default for StreaminOS)
export RADV_PERFTEST=aco
export mesa_glthread=true

# Gaming optimizations
export PROTON_ENABLE_NVAPI=1
export DXVK_ASYNC=1
export WINE_FULLSCREEN_FSR=1

# Sunshine streaming
export SUNSHINE_MIGRATE_CONFIG=1

# Custom environment variables
{% for key, value in streaminos_environment.items() %}
export {{ key }}="{{ value }}"
{% endfor %}

# Auto-start Sway on tty1 if not already running
if [ -z "$WAYLAND_DISPLAY" ] && [ "$XDG_VTNR" = "1" ]; then
    exec sway
fi

# ============================================================================
# wlroots Headless Backend Configuration
# ============================================================================
# Based on wlroots official documentation for headless streaming
# https://github.com/swaywm/wlroots/blob/master/docs/env_vars.md

# Backend: Pure headless with EGL framebuffer
export WLR_BACKENDS={{ wlr_backends }}

# Renderer: GLES2 is most stable for AMD + headless
export WLR_RENDERER={{ wlr_renderer }}

# Number of virtual displays
export WLR_HEADLESS_OUTPUTS={{ headless_outputs_count }}

# Disable physical input device detection (headless mode)
export WLR_LIBINPUT_NO_DEVICES={{ wlr_libinput_no_devices }}

# Allow software rendering fallback if GPU unavailable
export WLR_RENDERER_ALLOW_SOFTWARE={{ wlr_renderer_allow_software }}

# For debugging wlroots issues (optional)
# export WLR_DEBUG=1
