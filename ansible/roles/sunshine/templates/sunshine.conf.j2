# Sunshine Configuration
# Auto-generated by Ansible - StreaminOS
# Optimized for headless streaming with wlroots virtual displays

# Network configuration
address_family = both
port = {{ sunshine_https_port }}
external_ip = 0.0.0.0
origin_web_ui_allowed = wan

# Encoder configuration
# NOTE: Using software encoding due to Mesa 25.2.5 VAAPI bug
# Software encoding works perfectly and uses CPU instead of GPU
encoder = {{ sunshine_encoder }}
{% if sunshine_encoder == 'vaapi' %}
adapter_name = {{ sunshine_adapter }}
{% endif %}

# Encoding preset (lower = faster, higher = better quality)
sw_preset = {{ sunshine_sw_preset | default('medium') }}

# Resolution handling
# Use HEADLESS-2 (1080p display) for testing - no scaling needed
# 0 = HEADLESS-2 (1080p), 1 = HEADLESS-1 (4K)
output_name = 0

# Audio settings
audio_sink = {{ sunshine_audio_sink }}

# Capture method for gamescope
# KMS (Kernel Mode Setting) captures directly from DRM/KMS layer
# Works with any DRM-based compositor including gamescope
# Requires cap_sys_admin capability (set by Ansible)
capture = {{ sunshine_capture_method }}

# Pixel format (try to force a compatible format for VAAPI)
# Options: nv12, yuv420p, p010le
# pix_fmt = nv12

# Channels (simultaneous clients)
channels = {{ sunshine_channels }}

# Performance settings
min_fps = {{ sunshine_min_fps }}
sw_preset = {{ sunshine_sw_preset | default('medium') }}

# Threading for encoding
min_threads = {{ sunshine_min_threads | default(4) }}

# Logging
min_log_level = info

# File paths
file_apps = {{ sunshine_config_dir }}/apps.json
file_state = {{ sunshine_config_dir }}/state.json
credentials_file = {{ sunshine_config_dir }}/credentials.json

# UPnP
upnp = off

# Global preparation command - Dynamic resolution per client
# NOTE: With gamescope, resolution is handled via command-line flags
# Gamescope receives resolution dynamically via SUNSHINE_CLIENT_* environment variables
# No global_prep_cmd needed - gamescope launcher script handles this
# global_prep_cmd = []
