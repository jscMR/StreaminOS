# StreaminOS Sway Config
# Minimalist configuration for headless streaming server
# Auto-generated by Ansible

# Mod key (Mod4 = Super/Windows key)
set $mod Mod4

# Terminal
set $term foot

# Basic keybindings
bindsym $mod+Return exec $term
bindsym $mod+Shift+q kill
bindsym $mod+Shift+c reload
bindsym $mod+Shift+e exit

# ============================================================================
# Output Configuration - Headless Virtual Displays
# ============================================================================

# Physical outputs (if any monitor is connected)
output * bg /home/{{ streamin_user }}/Pictures/wallpaper.png fill

# Headless virtual display 1 (Primary - 4K@120Hz)
# Used for high-quality game streaming via Sunshine
output HEADLESS-1 {
    mode {{ headless_primary_resolution }}@{{ headless_primary_refresh }}Hz
    position 0 0
    bg /home/{{ streamin_user }}/Pictures/wallpaper.png fill
}

# Headless virtual display 2 (Secondary - 1080p@60Hz)
# Used for lower bitrate streams or secondary clients
# IMPORTANT: Disabled to avoid framebuffer concatenation issues with Sunshine
# If you need multiple displays, position them at 0,0 (overlapping) or stack vertically
# output HEADLESS-2 {
#     mode {{ headless_secondary_resolution }}@{{ headless_secondary_refresh }}Hz
#     position 0 0
#     bg /home/{{ streamin_user }}/Pictures/wallpaper.png fill
# }

# Additional headless displays can be configured here
# output HEADLESS-3 {
#     mode 2560x1440@120Hz
#     position 0 2160
#     bg /home/{{ streamin_user }}/Pictures/wallpaper.png fill
# }

# Window management
# No gaps, no borders (optimized for streaming)
default_border none
default_floating_border none
gaps inner 0
gaps outer 0

# Focus follows mouse
focus_follows_mouse yes

# Idle configuration (disabled for streaming)
# Games should prevent idle automatically

# XWayland support (for games that need it)
xwayland enable

# Hardware cursor (better performance)
seat * xcursor_theme default 24

# Input configuration
input type:keyboard {
    xkb_layout "us"
    repeat_delay 300
    repeat_rate 50
}

input type:mouse {
    accel_profile flat
    pointer_accel 0
}

# Disable screen blanking (important for streaming)
exec swayidle -w \
    timeout 0 '' \
    before-sleep ''

# Environment variables for gaming/streaming
exec systemctl --user import-environment DISPLAY WAYLAND_DISPLAY SWAYSOCK XDG_CURRENT_DESKTOP
exec hash dbus-update-activation-environment 2>/dev/null && \
    dbus-update-activation-environment --systemd DISPLAY WAYLAND_DISPLAY SWAYSOCK XDG_CURRENT_DESKTOP
